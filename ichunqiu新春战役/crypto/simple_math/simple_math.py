import sympy
from gmpy2 import gcd,invert
from random import randint
from Crypto.Util.number import getPrime,isPrime,getRandomNBitInteger,bytes_to_long


flag=b"flag{XXX}"


def gen_prime(N):
    A=0
    while 1:
        A=getPrime(N)
        if A%4==3:
            break
    return A
    
def gen_N(A,B):
    result=1
    for i in range(2,B+1):
        result=(result*i)%A
    return result
    
def gen_p():
    A=gen_prime(513)
    print("A:",A)
    B=(A-1)//2
    C=A-randint(1e3,1e5)
    print("C:",C)
    
    N1=gen_N(A,B)
    if N1<0:
        N1=(-1)*N1
    N2=gen_N(A,C)
    seed1=2019*N1+2020*N2
    return sympy.nextprime(seed1)
    
def gen_q():
    p=getPrime(1024)
    q=getPrime(1024)
    assert(p<q)
    n=p*q
    print("n:",n)
    e=getRandomNBitInteger(50)
    phi=(p-1)*(q-1)
    while gcd(e,phi)!=1:
        e=getRandomNBitInteger(50)
    d=invert(e,phi)
    print("e*d:",e*d)
    seed2=2020*p-2019*q
    if seed2<0:
        seed2=(-1)*seed2
    return sympy.nextprime(seed2)
    
if __name__=="__main__":
    _E=65537
    _P=gen_p()
    _Q=gen_q()
    assert(gcd(_E,(_P-1)*(_Q-1))==1)
    _M=bytes_to_long(flag)
    _C=pow(_M,_E,_P*_Q)
    print("ciphertext:",_C)


'''
output:
A:17837832555368308689786098708027973117794970348203719986383141676940062201987761202777419099369816828481341695174601689881519219806887761505932440928699539
C:17837832555368308689786098708027973117794970348203719986383141676940062201987761202777419099369816828481341695174601689881519219806887761505932440928632158
n:641840878174982655326850312496169636378455577115347500957057267640600977102280072913438154955029114771051709087809927454279064916870408880749853740239718248642560401110078626938726443568692572803490357236810832674229312155746539894173791356805341671586393273678865952155249500341932905426105470392415353610397045835698808163501258474762363712287163328526252399904787053101799058499120606154737990300449437479282435046167055009692493712202386368849122605419812883126887833074654434641607372149411668612504466768080306339558792828063148576123738980431264608446603326193849200810553196864085478463086993422774817059853949748247896512719994166090254440232652496451104455075071560127966288341488523110118075041150491577844082366096788215046025436488554795141938458493258409150407281215473354273599246314944034941237527510171900646139987019380766717951556307441871365874564881565374638513827494801194029940895912077179028101890662760455651864691251980479400416227456995236912364846811949410786643764713673564022863007331006828562341241738846980912184411395632790556038655767763976115640962139547171909279164623846000835333857705944581269631616760405747716520672142021728850694537269211784578408601266217928819863736428173736140161826738813
e*d:534634151124279413732259524933495479098721499860333007593590357554306358799023578194908726136928354695079848972480649724456088941906723794709312712191247045425297126517594344899286925836796680956816064609089090503579894117057252969264121691849003333804607728687046319857910698511132867345476426833313854575436202087209472834349551593011689755514138197238955298350562839877955001729313715223006875793667570760703418551390980455326976431990257513342820095246552412287184147009729875110446230949824384166464485840066906862476445054049749692262294734099027915906839812656254886862402603631321290156949953461665657610306709058617222159635281067103921037090824796905267992798715820128476225045484793453227511548884919811033318570386881936137713666127231317606909893143214808788822341878386939352957962886113639632559883992777992209148001401767753558732492213499792179169681405789041595765504039612494711563472885565786566625643290565526077483663342991770220261962082523632475094223960703649343802215392245948547397211539801128773253646005228684994277460378625729491412757387260415740823541731482803143732545953736392746596116269262129834845033889284145602522548909021358829175225208236295389454408336909318816490014229410357900614079212880259236238467905
ciphertext:183288709028723976658160448336519698700398459340947322152692016513169599029222514445118399653225032641541100129985101994918772329046946295962244096646038598600865786096896989355554955041779941259413115779915405468832327321189345505283184153652727885422718280179025251186380977491993641792341259672566237363655347151343020354489781675539571788934759950303331075098574759853670802171054084321131703969504258663714257549258635956184694450566287845760701724862418909255930636298209146539578608879672058346906370035692078859844402832322545368347681121504910035471822137023626638953992968941166744998545450662434365836169688461834868137046528403401190395486501502489519341656581057940794141420456022102711505759074332049547354944074402136763186087462931985682293826106916791831371302
'''