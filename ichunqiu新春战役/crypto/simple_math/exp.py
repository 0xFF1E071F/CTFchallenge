import sympy
from gmpy2 import gcd,invert
from random import randint
from Crypto.Util.number import *


A = 17837832555368308689786098708027973117794970348203719986383141676940062201987761202777419099369816828481341695174601689881519219806887761505932440928699539
C = 17837832555368308689786098708027973117794970348203719986383141676940062201987761202777419099369816828481341695174601689881519219806887761505932440928632158
n = 641840878174982655326850312496169636378455577115347500957057267640600977102280072913438154955029114771051709087809927454279064916870408880749853740239718248642560401110078626938726443568692572803490357236810832674229312155746539894173791356805341671586393273678865952155249500341932905426105470392415353610397045835698808163501258474762363712287163328526252399904787053101799058499120606154737990300449437479282435046167055009692493712202386368849122605419812883126887833074654434641607372149411668612504466768080306339558792828063148576123738980431264608446603326193849200810553196864085478463086993422774817059853949748247896512719994166090254440232652496451104455075071560127966288341488523110118075041150491577844082366096788215046025436488554795141938458493258409150407281215473354273599246314944034941237527510171900646139987019380766717951556307441871365874564881565374638513827494801194029940895912077179028101890662760455651864691251980479400416227456995236912364846811949410786643764713673564022863007331006828562341241738846980912184411395632790556038655767763976115640962139547171909279164623846000835333857705944581269631616760405747716520672142021728850694537269211784578408601266217928819863736428173736140161826738813
ed = 534634151124279413732259524933495479098721499860333007593590357554306358799023578194908726136928354695079848972480649724456088941906723794709312712191247045425297126517594344899286925836796680956816064609089090503579894117057252969264121691849003333804607728687046319857910698511132867345476426833313854575436202087209472834349551593011689755514138197238955298350562839877955001729313715223006875793667570760703418551390980455326976431990257513342820095246552412287184147009729875110446230949824384166464485840066906862476445054049749692262294734099027915906839812656254886862402603631321290156949953461665657610306709058617222159635281067103921037090824796905267992798715820128476225045484793453227511548884919811033318570386881936137713666127231317606909893143214808788822341878386939352957962886113639632559883992777992209148001401767753558732492213499792179169681405789041595765504039612494711563472885565786566625643290565526077483663342991770220261962082523632475094223960703649343802215392245948547397211539801128773253646005228684994277460378625729491412757387260415740823541731482803143732545953736392746596116269262129834845033889284145602522548909021358829175225208236295389454408336909318816490014229410357900614079212880259236238467905
ciphertext = 183288709028723976658160448336519698700398459340947322152692016513169599029222514445118399653225032641541100129985101994918772329046946295962244096646038598600865786096896989355554955041779941259413115779915405468832327321189345505283184153652727885422718280179025251186380977491993641792341259672566237363655347151343020354489781675539571788934759950303331075098574759853670802171054084321131703969504258663714257549258635956184694450566287845760701724862418909255930636298209146539578608879672058346906370035692078859844402832322545368347681121504910035471822137023626638953992968941166744998545450662434365836169688461834868137046528403401190395486501502489519341656581057940794141420456022102711505759074332049547354944074402136763186087462931985682293826106916791831371302
R = A - C
N1 = 1
R = R - 1
N2 = -1
while R >= 1:
    N2 = (N2) * invert(A - R, A) % A
    R = R - 1
seed1 = 2019 * N1 + 2020 * N2
_P = sympy.nextprime(seed1)
print "p: %d" % _P

def cal_from_d(N, ed):
    r = ed - 1
    s = 2
    while r % s == 0:
        s *= 2
    r = r / (s / 2)
    w = getRandomRange(1, N)
    x = GCD(w, N)
    if 1 < x and x < N:
        return x, N / x
    v = pow(w, r, N)
    if v % N == 1:
        return -1, -1
    v_ = 0
    while v % N != 1:
        v_ = v
        v = pow(v, 2, N)
    if v_ % N == N - 1:
        return -1, -1
    p = GCD(v_ + 1, N)
    return p, N / p

q, p = cal_from_d(n, ed)
while p == -1 and q == -1:
    q, p = cal_from_d(n, ed)
seed2 = 2020 * p - 2019 * q
if seed2 < 0:
    seed2 = (-1) * seed2
_Q = sympy.nextprime(seed2)
print "q: %d" % _Q

_E = 65537

_PHI = (_P - 1) * (_Q - 1)

print "invert(%d, %d)" % (_E, _PHI)
_D = invert(_E, _PHI)
flag = pow(ciphertext, _D, _P * _Q)
print long_to_bytes(flag)